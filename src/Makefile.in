# ===> Makefile
#
#   Makefile            Xianjun WANG            3/1994
#
#   used to compile AUTO libraries
#
#
CC=@CC@
FC=@FC@
CFLAGS=@CFLAGS@
FFLAGS=@FFLAGS@
OPT=@OPT_FLAG@
OBJ= ../lib/autlib1.o ../lib/autlib2.o ../lib/autlib3.o ../lib/autlib4.o ../lib/autlib5.o ../lib/blas.o ../lib/eispack.o ../lib/mpi.o @COMPAT@
RM=rm -f
#
all: lib compile ../bin/autlab ../bin/double ../bin/triple \
  ../bin/keeplp ../bin/keepbp ../bin/keepsp ../bin/keepuz \
  ../bin/deletelp ../bin/deleteuz \
  ../bin/listlabels ../bin/reduce ../bin/relabel ../lib/libauto_c.a move
#
auto.h: ../include/auto.h
	@cp -p ../include/auto.h auto.h
#
lib:
	@mkdir -p ../lib
#
compile: $(OBJ)
#
../lib/autlib1.o: autlib1.f ../lib/autlib2.o ../lib/autlib3.o ../lib/autlib4.o ../lib/autlib5.o auto.h
	$(FC) $(FFLAGS) $(OPT) -c autlib1.f -o $@
#
../lib/autlib2.o: autlib2.f auto.h
	$(FC) $(FFLAGS) $(OPT) -c autlib2.f -o $@
#
../lib/autlib3.o: autlib3.f auto.h
	$(FC) $(FFLAGS) $(OPT) -c autlib3.f -o $@
#
../lib/autlib4.o: autlib4.f auto.h
	$(FC) $(FFLAGS) $(OPT) -c autlib4.f -o $@
#
../lib/autlib5.o: autlib5.f ../lib/autlib3.o auto.h
	$(FC) $(FFLAGS) $(OPT) -c autlib5.f -o $@
#
../lib/libauto_c.a: user_c.c ../include/auto_f2c.h ../include/config.h
	rm -f $@
	$(CC) -I../include $(CFLAGS) $(OPT) -c user_c.c -o user_c.o
	ar cr $@ user_c.o
	rm -f user_c.o
#
../bin/autlab: autlab.f auto.h
	$(FC) $(FFLAGS) $(OPT) autlab.f -o $@
#
../bin/double: double.f auto.h
	$(FC) $(FFLAGS) $(OPT) double.f -o $@
#
../bin/triple: triple.f auto.h
	$(FC) $(FFLAGS) $(OPT) triple.f -o $@
#
../bin/keepbp: keepbp.f
	$(FC) $(FFLAGS) $(OPT) keepbp.f -o $@
#
../bin/keeplp: keeplp.f
	$(FC) $(FFLAGS) $(OPT) keeplp.f -o $@
#
../bin/keepuz: keepuz.f
	$(FC) $(FFLAGS) $(OPT) keepuz.f -o $@
#
../bin/keepsp: keepsp.f
	$(FC) $(FFLAGS) $(OPT) keepsp.f -o $@
#
../bin/deletelp: deletelp.f
	$(FC) $(FFLAGS) $(OPT) deletelp.f -o $@
#
../bin/deleteuz: deleteuz.f
	$(FC) $(FFLAGS) $(OPT) deleteuz.f -o $@
#
../bin/listlabels: listlabels.f auto.h
	$(FC) $(FFLAGS) $(OPT) listlabels.f -o $@
#
../bin/reduce: reduce.f auto.h
	$(FC) $(FFLAGS) $(OPT) reduce.f -o $@
#
../bin/relabel: relabel.f auto.h
	$(FC) $(FFLAGS) $(OPT) relabel.f -o $@
#
fcon: $(AUTO_DIR)/src/fcon.f
	@if [ -f $(EQUATION_NAME).f ]; then \
	  $(FC) $(FFLAGS) $(OPT) $(EQUATION_NAME).f $(AUTO_DIR)/src/fcon.f -o fcon; \
	elif [ -f $(EQUATION_NAME).c ]; then \
	  $(CC) -I$(AUTO_DIR)/include $(CFLAGS) $(OPT) -c $(EQUATION_NAME).c -o fcone.o; \
	  $(FC) -L$(AUTO_DIR)/lib $(FFLAGS) $(OPT) fcone.o $(AUTO_DIR)/src/fcon.f -o fcon -lauto_c; \
	fi
#
zero: $(AUTO_DIR)/src/zero.f
	$(FC) $(FFLAGS) $(OPT) $(AUTO_DIR)/src/zero.f -o zero
#
../lib/eispack.o: eispack.f
	$(FC) $(FFLAGS) $(OPT) -c eispack.f -o $@
#
../lib/blas.o: blas.f
	$(FC) $(FFLAGS) $(OPT) -c blas.f -o $@
#
../lib/compat.o: compat.f90
	$(FC) $(FFLAGS) $(OPT) -c compat.f90 -o $@
#
../lib/mpi.o: @MPIFILE@ auto.h
	$(FC) $(FFLAGS) $(OPT) -c @MPIFILE@ -o $@
#
move: $(OBJ)
	@$(RM) auto.h
#
superclean:
	cd ../lib && rm -f *.o *.a
	rm -f *.mod
	rmdir ../lib 2> /dev/null; true
#
#  DO NOT ADD ANYTHING AFTER THIS LINE
#
