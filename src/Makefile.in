# ===> Makefile
#
#   Makefile            Xianjun WANG            3/1994
#
#   used to compile AUTO libraries
#
#
CC=@CC@
FC=@FC@
CFLAGS=@CFLAGS@
FFLAGS=@FFLAGS@
OPT=@OPT_FLAG@
OBJ= ../lib/autlib1.o ../lib/blas.o ../lib/eispack.o @COMPAT@
RM=rm -f
#
all: lib compile ../lib/libauto_c.a move
#
lib:
	@mkdir -p ../lib
#
compile: $(OBJ)
#
../lib/autlib1.o: autlib1.f ../lib/ae.o ../lib/autlib5.o ../include/auto.h
	$(FC) $(FFLAGS) $(OPT) -I../include -c autlib1.f -o $@
#
../lib/autlib2.o: autlib2.f ../lib/support.o ../lib/mpi.o
	$(FC) $(FFLAGS) $(OPT) -c autlib2.f -o $@
#
../lib/autlib3.o: autlib3.f ../lib/bvp.o
	$(FC) $(FFLAGS) $(OPT) -c autlib3.f -o $@
#
../lib/autlib4.o: autlib4.f
	$(FC) $(FFLAGS) $(OPT) -c autlib4.f -o $@
#
../lib/autlib5.o: autlib5.f ../lib/autlib3.o
	$(FC) $(FFLAGS) $(OPT) -c autlib5.f -o $@
#
../lib/ae.o: ae.f90 ../lib/io.o ../lib/support.o ../lib/mpi.o ../include/auto.h
	$(FC) $(FFLAGS) $(OPT) -I../include -c ae.f90 -o $@
#
../lib/bvp.o: bvp.f90 ../lib/autlib2.o ../lib/autlib4.o ../lib/io.o ../include/auto.h
	$(FC) $(FFLAGS) $(OPT) -I../include -c bvp.f90 -o $@
#
../lib/support.o: support.f90 ../lib/mesh.o
	$(FC) $(FFLAGS) $(OPT) -c support.f90 -o $@
#
../lib/io.o: io.f90
	$(FC) $(FFLAGS) $(OPT) -c io.f90 -o $@
#
../lib/mesh.o: mesh.f90
	$(FC) $(FFLAGS) $(OPT) -c mesh.f90 -o $@
#
../lib/libauto_c.a: user_c.c ../include/auto_f2c.h ../include/config.h
	rm -f $@
	$(CC) -I../include $(CFLAGS) $(OPT) -c user_c.c -o user_c.o
	ar cr $@ user_c.o
	rm -f user_c.o
#
fcon: $(AUTO_DIR)/src/fcon.f
	@if [ -f $(EQUATION_NAME).f90 ]; then \
	  $(FC) $(FFLAGS) $(OPT) $(EQUATION_NAME).f90 $(AUTO_DIR)/src/fcon.f -o fcon; \
	elif [ -f $(EQUATION_NAME).f ]; then \
	  $(FC) $(FFLAGS) $(OPT) $(EQUATION_NAME).f $(AUTO_DIR)/src/fcon.f -o fcon; \
	elif [ -f $(EQUATION_NAME).c ]; then \
	  $(CC) -I$(AUTO_DIR)/include $(CFLAGS) $(OPT) -c $(EQUATION_NAME).c -o fcone.o; \
	  $(FC) -L$(AUTO_DIR)/lib $(FFLAGS) $(OPT) fcone.o $(AUTO_DIR)/src/fcon.f -o fcon -lauto_c; \
	fi
#
../lib/eispack.o: eispack.f
	$(FC) $(FFLAGS) $(OPT) -c eispack.f -o $@
#
../lib/blas.o: blas.f
	$(FC) $(FFLAGS) $(OPT) -c blas.f -o $@
#
../lib/compat.o: compat.f90
	$(FC) $(FFLAGS) $(OPT) -c compat.f90 -o $@
#
../lib/mpi.o: @MPIFILE@ ../include/auto.h
	$(FC) $(FFLAGS) $(OPT) -I../include -c @MPIFILE@ -o $@
#
move: $(OBJ)
	@$(RM) auto.h
#
superclean:
	cd ../lib && rm -f *.o *.a
	rm -f *.mod *.o
	rmdir ../lib 2> /dev/null; true
#
#  DO NOT ADD ANYTHING AFTER THIS LINE
#
